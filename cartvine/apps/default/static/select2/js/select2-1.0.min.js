(function(a){function i(b){var c=function(c){var d=this;b.attrs!==undefined&&a.each(b.attrs,function(a,b){if(c[a]!==undefined)d[a]=c[a];else{if(b.required===!0)throw"Value for required attribute: "+a+" not defined";b.init!==undefined&&(d[a]=typeof b.init=="function"?b.init.apply(d):b.init)}}),b.methods!==undefined&&b.methods.init!==undefined&&d.init(c)};if(b.methods!==undefined){if(b.methods.bind!==undefined)throw"Class cannot declare a method called 'bind'";a.each(b.methods,function(a,b){c.prototype[a]=b}),c.prototype.bind=function(a){var b=this;return function(){a.apply(b,arguments)}}}return c}"use strict";var b,c,d,e,f,g,h;b={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46},c={},c.debounce=function(a,b){var c;return function(){window.clearTimeout(c),c=window.setTimeout(b,a)}},c.debounceEvent=function(a,b,d,e,f){e=e||d+"-debounced",f=f||!0;var g=c.debounce(b,function(b){a.trigger(e,b)});a.on(d,function(b){if(f&&a.get().indexOf(b.target)<0)return;g(b)})},function(){var b;c.filterMouseEvent=function(c,d,e,f){e=e||d+"-filtered",f=f||!1,c.on(d,"*",function(d){if(f&&c.get().indexOf(d.target)<0)return;if(b===undefined||b.x!==d.pageX||b.y!==d.pageY)a(d.target).trigger(e,d),b={x:d.pageX,y:d.pageY}})}}(),d=i({attrs:{container:{required:!0},element:{required:!0},bus:{required:!0}},methods:{open:function(){if(this.isOpen())return;this.container.addClass("select2-dropdown-open"),a(document).on("mousedown.dropdown",this.bind(function(b){var c=!1,d=this.container.get(0);a(b.target).parents().each(function(){return!(c=this===d)}),c||this.close()})),this.element.show(),this.bus.trigger("opened")},close:function(){if(!this.isOpen())return;this.container.removeClass("select2-dropdown-open"),a(document).off("mousedown.dropdown"),this.element.hide(),this.bus.trigger("closed")},isOpen:function(){return this.container.hasClass("select2-dropdown-open")},toggle:function(){this.isOpen()?this.close():this.open()}}}),e=i({attrs:{element:{required:!0},bus:{required:!0},formatInputTooShort:{required:!0},formatNoMatches:{required:!0},formatResult:{required:!0},minimumInputLength:{required:!0},query:{required:!0},selection:{required:!0}},methods:{init:function(){var d=this;this.search=this.element.find("input"),this.results=this.element.find("ul"),this.scrollPosition=0,this.vars={},this.search.on("keyup",function(a){(a.which>=48||a.which===b.SPACE||a.which===b.BACKSPACE||a.which===b.DELETE)&&d.update()}),this.search.on("keydown",function(a){switch(a.which){case b.TAB:a.preventDefault(),d.select();return;case b.ENTER:a.preventDefault(),a.stopPropagation(),d.select();return;case b.UP:d.moveSelection(-1),a.preventDefault(),a.stopPropagation();return;case b.DOWN:d.moveSelection(1),a.preventDefault(),a.stopPropagation();return;case b.ESC:a.preventDefault(),a.stopPropagation(),d.cancel();return}}),c.filterMouseEvent(this.results,"mousemove"),this.results.on("mousemove-filtered",this.bind(function(b){var c=a(b.target).closest("li.select2-result");if(c.length<1)return;this.setSelection(c.index())})),this.results.on("click",this.bind(function(b){var c=a(b.target).closest("li.select2-result");if(c.length<1)return;this.bus.trigger("selected",[c.data("select2-result")])})),c.debounceEvent(this.results,100,"scroll"),this.results.on("scroll-debounced",this.bind(function(a){this.scrollPosition=this.results.scrollTop();var b=this.results.find("li.select2-more-results"),c;if(b.length===0)return;c=b.offset().top-this.results.offset().top-this.results.height(),c<=0&&(b.addClass("select2-active"),this.query({term:this.search.val(),vars:this.vars,callback:this.bind(this.append)}))}))},open:function(a){this.search.focus(),this.results.scrollTop(this.scrollPosition),this.results.children().length===0&&this.update()},close:function(){},clear:function(){this.results.empty()},showInputTooShort:function(){this.show("<li class='select2-no-results'>"+this.formatInputTooShort(this.search.val(),this.minimumInputLength)+"</li>")},showNoMatches:function(){this.show("<li class='select2-no-results'>"+this.formatNoMatches(this.search.val())+"</li>")},show:function(a){this.results.html(a),this.results.scrollTop(0),this.search.removeClass("select2-active")},update:function(){var a="";if(this.search.val().length<this.minimumInputLength){this.showInputTooShort();return}this.search.addClass("select2-active"),this.vars={},this.query({term:this.search.val(),vars:this.vars,callback:this.bind(this.process)})},process:function(b){if(b.results.length===0){this.showNoMatches();return}var c=this.stringizeResults(b.results),d=this.selection.val(),e=0;b.more===!0&&(c+="<li class='select2-more-results'>Loading more results...</li>"),this.vars=b.vars||{},this.show(c),this.findChoices().each(function(c){d===b.results[c].id&&(e=c),a(this).data("select2-result",b.results[c])}),this.setSelection(e)},append:function(b){var c=this.results.find("li.select2-more-results"),d,e;this.vars=b.vars||{};if(b.results.length===0){c.remove();return}d=this.stringizeResults(b.results),e=this.results.find("li.select2-result").length,c.before(d),this.results.find("li.select2-result").each(function(c){c>=e&&a(this).data("select2-result",b.results[c-e])}),b.more!==!0?c.remove():c.removeClass("select2-active")},stringizeResults:function(a,b){var c,d,e;b=b||"";for(c=0,d=a.length;c<d;c+=1)b+="<li class='select2-result'>",b+=this.formatResult(a[c]),b+="</li>";return b},findChoices:function(){return this.results.children("li.select2-result")},removeSelection:function(){this.findChoices().each(function(){a(this).removeClass("select2-highlighted")})},setSelection:function(b){this.removeSelection();var c=this.findChoices(),d=a(c[b]),e,f,g,h;d.addClass("select2-highlighted"),this.search.focus(),e=d.offset().top+d.outerHeight(),b===c.length-1&&(h=this.results.find("li.select2-more-results"),h.length>0&&(e=h.offset().top+h.outerHeight())),f=this.results.offset().top+this.results.outerHeight(),e>f&&this.results.scrollTop(this.results.scrollTop()+(e-f)),g=d.offset().top-this.results.offset().top,g<0&&this.results.scrollTop(this.results.scrollTop()+g)},getSelectionIndex:function(){var b=this.findChoices(),c=0,d=b.length;for(;c<d;c+=1)if(a(b[c]).hasClass("select2-highlighted"))return c;return-1},moveSelection:function(a){var b=this.getSelectionIndex(),c=this.findChoices(),d=b+a;b>=0&&d>=0&&d<c.length&&this.setSelection(d)},select:function(){var a=this.results.find("li.select2-highlighted");a.length>0&&this.bus.trigger("selected",[a.data("select2-result")])},cancel:function(){this.bus.trigger("cancelled")},val:function(b){var c=this.findChoices(),d;c.each(function(c){if(a(this).data("select2-result").id===b)return d=c,!1}),d===undefined&&b.id!==undefined&&c.each(function(c){if(a(this).data("select2-result").id===b.id)return d=c,!1});if(d!==undefined){this.setSelection(d),this.select();return}this.bus.trigger("selected",b)}}}),f=i({attrs:{bus:{required:!0},element:{required:!0},display:{init:function(){return this.element.find("span")}},hidden:{required:!0},formatSelection:{required:!0},placeholder:{},dropdown:{required:!0}},methods:{init:function(){this.placeholder&&this.select(this.placeholder),this.element.click(this.dropdown.bind(this.dropdown.toggle));var a=this;this.element.on("keydown",function(c){switch(c.which){case b.TAB:case b.SHIFT:case b.CTRL:case b.ALT:case b.LEFT:case b.RIGHT:return}a.dropdown.open()})},select:function(a){this.display.html(this.formatSelection(a)),this.hidden.val(a.id)},focus:function(){this.element.focus()},val:function(){return this.hidden.val()}}}),h={},h.select=function(b,c){var d=[];return c.find("option").each(function(){var b=a(this);d.push({id:b.attr("value"),text:b.text()})}),function(b){var c={results:[],more:!1},e=b.term.toUpperCase();a.each(d,function(a){this.text.toUpperCase().indexOf(e)>=0&&c.results.push(this)}),b.callback(c)}},h.ajax=function(b,c){var d,e=0,f=b.ajax.quietMillis||100;return function(c){window.clearTimeout(d),d=window.setTimeout(function(){e+=1;var d=e,f=b.ajax,g=f.data;g=g.call(this,c.term,c.vars),a.ajax({url:f.url,dataType:f.dataType,data:g}).success(function(a){if(d<e)return;c.callback(f.results(a,c.vars))})},f)}},g=i({attrs:{el:{required:!0},formatResult:{init:function(){return function(a){return a.text}}},formatSelection:{init:function(){return function(a){return a.text}}},formatNoMatches:{init:function(){return function(){return"No matches found"}}},formatInputTooShort:{init:function(){return function(a,b){return"Please enter "+(b-a.length)+" more characters to start search"}}},minimumInputLength:{init:0},placeholder:{init:undefined},ajax:{init:undefined},query:{init:undefined}},methods:{init:function(){var b=this,c,g,i,j,k;this.el=a(this.el),c=this.el.outerWidth(),this.container=a("<div></div>",{"class":"select2-container",style:"width: "+c+"px"}),this.container.html("   <a href='javascript:void(0)' class='select2-choice'>   <span></span>   <div><b></b></div></a><div class='select2-drop' style='display:none;'>   <div class='select2-search'>       <input type='text' autocomplete='off'/>   </div>   <ul class='select2-results'>   </ul></div><input type='hidden'/>"),this.el.data("select2",this),this.el.hide(),this.el.after(b.container),this.el.attr("class")!==undefined&&this.container.addClass(this.el.attr("class")),this.container.data("select2",this),this.container.find("input[type=hidden]").attr("name",this.el.attr("name")),this.query===undefined&&this.el.get(0).tagName.toUpperCase()==="SELECT"&&(this.query="select",k=!0),h[this.query]!==undefined&&(this.query=h[this.query](this,this.el)),function(){function f(a){return a.outerWidth()-a.width()}var a,c,d,e;a=b.container.find("div.select2-drop"),e=b.container.outerWidth()-f(a),a.css({top:b.container.height(),width:e}),c=b.container.find(".select2-search"),d=c.find("input"),e=a.width(),e-=f(c),e-=f(d),d.css({width:e})}(),g=new d({element:this.container.find("div.select2-drop"),container:this.container,bus:this.el}),this.selection=new f({bus:this.el,element:this.container.find(".select2-choice"),hidden:this.container.find("input[type=hidden]"),formatSelection:this.formatSelection,placeholder:this.placeholder,dropdown:g}),this.results=new e({element:this.container.find("div.select2-drop"),bus:this.el,formatInputTooShort:this.formatInputTooShort,formatNoMatches:this.formatNoMatches,formatResult:this.formatResult,minimumInputLength:this.minimumInputLength,query:this.query,selection:this.selection}),this.el.on("selected",function(a,c){g.close(),b.selection.select(c)}),this.el.on("cancelled",function(){g.close()}),this.el.on("opened",this.bind(function(){this.results.open()})),this.el.on("closed",this.bind(function(){this.container.removeClass("select2-dropdown-open"),this.results.close(),this.selection.focus()})),k&&(this.results.update(),j=this.el.find("option[selected]"),j.length<1&&this.placeholder===undefined&&(j=a(this.el.find("option")[0])),j.length>0&&this.val({id:j.attr("value"),text:j.text()}))},val:function(){var a;if(arguments.length===0)return this.selection.val();a=arguments[0],this.results.val(a)}}}),a.fn.select2=function(){var b=Array.prototype.slice.call(arguments,0),c,d;return this.each(function(){if(b.length===0)d=new g({el:this});else if(typeof b[0]=="object")b[0].el=this,d=new g(b[0]);else{if(typeof b[0]=="string"){var e=a(this).data("select2");return c=e[b[0]].apply(e,b.slice(1)),!1}throw"Invalid arguments to select2 plugin: "+b}}),c===undefined?this:c}})(jQuery)